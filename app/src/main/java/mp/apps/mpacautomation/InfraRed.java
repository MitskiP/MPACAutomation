package mp.apps.mpacautomation;

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import android.content.Context;
import android.hardware.ConsumerIrManager;
import android.util.Log;
import android.view.View;

public class InfraRed {

    private ConsumerIrManager irService;

    public InfraRed(Context s) {

        irService = (ConsumerIrManager)s.getSystemService(Context.CONSUMER_IR_SERVICE);

        if (!irService.hasIrEmitter())
            return;

        ConsumerIrManager.CarrierFrequencyRange[] cfr = irService.getCarrierFrequencies();
        for (ConsumerIrManager.CarrierFrequencyRange c : cfr) {
            Log.d(">>>", c.getMinFrequency() + " - " + c.getMaxFrequency());
        }

    }

    private void sendRaw(int freq, String data) {
        if (data != null && irService.hasIrEmitter()) {
            String values[] = data.split(" ");
            int[] pattern = new int[values.length];
            for (int i = 0; i < pattern.length; i++) {
                pattern[i] = Integer.parseInt(values[i]);
            }
            Log.d("sendRAW", data);
            irService.transmit(freq, pattern);
            Log.d(">>>", "Done.");
        }
    }

    private void sendHexData(String data) {
        if (data != null && irService.hasIrEmitter()) {
            Log.d("sendHEX", data);
            data = hex2dec(data);
            sendData(data);
        }
    }
    private void sendData(String data) {
        if (data != null && irService.hasIrEmitter()) {
            String values[] = data.split(" ");
            int[] pattern = new int[values.length-1];
            for (int i = 0; i < pattern.length; i++) {
                pattern[i] = Integer.parseInt(values[i+1]);
            }
            int freq = Integer.parseInt(values[0]);

            Log.d("sendData", data);
            irService.transmit(freq, pattern);
            Log.d(">>>", "Done.");
        }
    }

    private static final String hex2dec(String irData) {
        List<String> list = new ArrayList<String>(Arrays.asList(irData.split(" ")));
        list.remove(0); // dummy
        int frequency = Integer.parseInt(list.remove(0), 16); // frequency
        list.remove(0); // seq1
        list.remove(0); // seq2

        for (int i = 0; i < list.size(); i++) {
            list.set(i, Integer.toString(Integer.parseInt(list.get(i), 16)));
        }

        frequency = (int) (1000000 / (frequency * 0.241246));
        list.add(0, Integer.toString(frequency));

        irData = "";
        for (String s : list) {
            irData += s + " ";
        }
        return irData;
    }



    // 439 dead
    //public static final String OFF = "600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600";
    // 400 dead
    //public static final String OFF = "600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600";
    // 300
    //public static final String OFF = "600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600";
    // 439
    //public static final String OFF = "100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100 100";
    //public static final String OFF = "40000 40000 40000 40000 40000 40000 40000 40000 40000 40000 40000 40000 40000 40000 600 600 600 600 600 600 600 600";


    //public static final String OFF = "3397 1725 398 1300 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 29456 3397 1725 398 1300 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 451 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398";

    public static final String OFF[] = new String[] {
            "3397 1725 398 1300 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 29456",
            "3397 1725 398 1300 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 451 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398",
    };
    public static final String DRY[] = new String[] {
            "3397 1725 398 1300 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 29456",
            // default
            //"3397 1725 398 1300 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 451 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 451 398",
            // fan 1/5
            //"3397 1725 398 1300 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 1300 398 1300 398 1300 398 1300 398",
            // fan 5/5
            "3397 1725 398 1300 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 1300 398 451 398 1300 398 1300 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 1300 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 451 398 1300 398 451 398 451 398 1300 398 1300 398 451 398 451 398",
    };
    public void call(String s) {
        if (s == null)
            return;
        if ("OFF".equals(s)) {
            sendRaw(38000, OFF[1]);
        } else if ("DRY".equals(s)) {
            sendRaw(38000, DRY[1]);
        }
        //for (String s : DRY)
        //    sendRaw(38000, s);
    }

    public boolean isAvailable() {
        return irService.hasIrEmitter();
    }
}