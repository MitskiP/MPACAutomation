#!/bin/bash

# https://github.com/blafois/Daikin-IR-Reverse


toBytes() {
	# insert space every 8th char
	sed 's/.\{8\}/& /g'
}
reverse() {
	for i in $@; do
		rev <<< "$i"
	done
}
toHex() {
	for i in $@; do
		printf '%2x' "$((2#$i))" | tr ' ' '0'
		printf " "
	done
	printf "\n"
}

while read -r line; do
	#echo "$line" | sed -e 's/3397/ONE/g' -e 's/1725/ZERO /g' -e 's/29456/ END/g' -e 's/ 398 //g' -e 's/ 398$//g' -e 's/1300/1/g' -e 's/451/0/g'
	line="`sed -e 's/3431/3397/g' -e 's/1756/1725/g' -e 's/405/398/g' -e 's/1324/1300/g' -e 's/459/451/g' -e 's/29667/29456/g' <<< "$line"`"
	stream="`echo "$line" | sed -e 's/3397 //g' -e 's/1725//g' -e 's/29456//g' -e 's/ 398 //g' -e 's/ 398$//g' -e 's/1300/1/g' -e 's/451/0/g'`"
	bytesR="`echo "$stream" | toBytes`"
	#echo $bytesR
	bytes="`reverse $bytesR`"
	echo $bytes
	toHex "$bytes"

done < "$1"

exit


# original: 10001000010110111110010000000000000000001000010000000011000000001111010111110000000000000000000000000000000000000000000000000011000000000000000010001110
# we expect '11 da 27 00' as the first four bytes.
# 11 da 27 00 = 00010001 11011010 0010 0111 0000 0000
# -> LSB: 10001000 01011011 11100100 00000000

#000000001000010000000011000000001111010111110000000000000000000000000000000000000000000000000011000000000000000010001110



# header
11 da 27 00
# msg id
00
# Mode, On/Off, Timer
21 = 0010 0001 # dry
49 = 0100 1001 # Heat, On, No Timer
0000 - AUTO
0010 - DRY
0011 - COLD
0100 - HEAT
0110 - FAN

1001 - power on
1000 - power off

# temp
c0

00 af 0f 00 00 00 00 00 c0 00 00 71


fan 1/5
./back 11 da 27 00 00 21 c0 00    00110000    0f 00 00 00 00 00 c0 00 00
fan 2/5
./back 11 da 27 00 00 21 c0 00    01000000    0f 00 00 00 00 00 c0 00 00
fan 3/5
./back 11 da 27 00 00 21 c0 00    01010000    0f 00 00 00 00 00 c0 00 00
fan 4/5
./back 11 da 27 00 00 21 c0 00    01100000    0f 00 00 00 00 00 c0 00 00
fan 5/5
./back 11 da 27 00 00 21 c0 00    01110000    0f 00 00 00 00 00 c0 00 00



10001000 01011011 11100100 00000000 00000000 10000100 00000011 00000000 11110101 11110000 00000000 00000000 00000000 00000000 00000000 00000011 00000000 00000000 10001110
1   1    d   a    2   7    0   0    0   0    2   1    c   0    0   0    a   f    0   f    0   0    0   0    0   0    0   0    0   0    c   0    0   0    0   0    7   1
11 da 27 00 00 21 c0 00 af 0f 00 00 00 00 00 c0 00 00 71
11 da 27 00 00 21 c0       00 af 0f 00 00 00 00 00 c0 00 00 71

fan 1/5
11 da 27 00 00 21 c0 30 af 0f 00 00 00 00 00 c0 00 00 a1
10001000 01011011 11100100 00000000 00000000 10000100 00000011    00001100 11110101 11110000 00000000 00000000 00000000 00000000 00000000 00000011 00000000 00000000 10000101
fan 5/5
11 da 27 00 00 21 c0 70 af 0f 00 00 00 00 00 c0 00 00 e1
10001000 01011011 11100100 00000000 00000000 10000100 00000011    00001110 11110101 11110000 00000000 00000000 00000000 00000000 00000000 00000011 00000000 00000000 10000111























